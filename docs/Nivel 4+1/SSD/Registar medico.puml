@startuml
title Registo de Médico com Autenticação JWT (Visão Plana)

actor "Admin" as User
participant ":Frontend" as Frontend
participant ":API Gateway" as Gateway
participant ":AuthenticationService" as AuthService
participant PhysicianController as Controller
participant PhysicianServiceImpl as Service
participant PhysicianRepository as Repo
database ":H2Database" as DB

autonumber

group Fase 1: Autenticação e Obtenção do Token

    User -> Frontend : Inicia login com credenciais
    Frontend -> Gateway : 1. POST /auth/login (admin, pass)
    Gateway -> AuthService : 1.1. Validar credenciais
    AuthService --> Gateway : 1.2. Retorna Token JWT
    Gateway --> Frontend : 1.3. Retorna Token JWT
    Frontend -> Frontend : 1.4. Armazena o token de forma segura
    Frontend --> User : Login bem-sucedido, exibe dashboard

end

group Fase 2: Registo de Médico (Ação Autorizada)

    User -> Frontend : Submete formulário de registo do médico

    Frontend -> Gateway : 2. POST /physicians (body JSON, \n**Authorization: Bearer <JWT>**)

    Gateway -> Gateway : 3. Valida a assinatura, expiração e permissões (role) do JWT

    Gateway -> Controller : 4. POST / (body JSON)

    Controller -> Controller : 5. Framework valida e cria o PhysicianCreateDto
    Controller -> Service : 6. register(createDto)
    Service -> Service : 7. Cria a entidade Physician a partir do DTO
    Service -> Repo : 8. save(physician)
    Repo -> DB : 8.1. INSERT na tabela de médicos
    Repo --> Service : 8.2. Retorna `savedPhysician` (com ID)
    Service -> Service : 9. Mapeia `savedPhysician` para `PhysicianDto`
    Service --> Controller : 10. Retorna o `PhysicianDto`

    Controller --> Gateway : 11. Retorna HTTP 201 Created + JSON

    Gateway --> Frontend : 12. Retorna HTTP 201 Created + JSON
    Frontend --> User : 13. Exibe mensagem de "Médico registado com sucesso!"

end
@enduml